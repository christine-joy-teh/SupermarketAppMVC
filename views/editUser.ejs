<%- include('partials/head', { pageTitle: 'Edit User - Supermarket App' }) %>
<%- include('partials/navbar', {
  navLinksLeft: [
    { href: '/inventory', label: 'Inventory' },
    { href: '/addProduct', label: 'Add Product' },
    { href: '/admin/orders', label: 'Orders' },
    { href: '/admin/users', label: 'Users', active: true },
    { href: '/admin/promotion', label: 'Promotion' }
  ],
  navLinksRight: [
    { href: '/logout', label: 'Logout' }
  ]
}) %>

<div class="container py-4" style="max-width: 720px;">
  <h3 class="mb-3">Edit User</h3>
  <% if (success && success.length) { %>
    <div class="alert alert-success"><%= success[0] %></div>
  <% } %>
  <% if (error && error.length) { %>
    <div class="alert alert-danger"><%= error[0] %></div>
  <% } %>

  <% if (targetUser) { %>
    <form method="POST" action="/admin/users/<%= targetUser.id %>">
      <div class="mb-3">
        <label class="form-label" for="username">Username</label>
        <input id="username" name="username" type="text" class="form-control" required value="<%= targetUser.username %>">
      </div>
      <div class="mb-3">
        <label class="form-label" for="email">Email</label>
        <input id="email" name="email" type="email" class="form-control" required value="<%= targetUser.email %>">
      </div>
      <div class="mb-3">
        <label class="form-label" for="role">Role</label>
        <select id="role" name="role" class="form-select" required>
          <option value="user" <%= targetUser.role === 'user' ? 'selected' : '' %>>User</option>
          <option value="admin" <%= targetUser.role === 'admin' ? 'selected' : '' %>>Admin</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label" for="plan">Plan</label>
        <select id="plan" name="plan" class="form-select">
          <option value="">None</option>
          <option value="basic" <%= targetUser.plan === 'basic' ? 'selected' : '' %>>Basic</option>
          <option value="silver" <%= targetUser.plan === 'silver' ? 'selected' : '' %>>Silver</option>
          <option value="gold" <%= targetUser.plan === 'gold' ? 'selected' : '' %>>Gold</option>
        </select>
        <small class="text-muted">Choose a membership for this user.</small>
      </div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" value="1" id="disabled" name="disabled" <%= targetUser.disabled ? 'checked' : '' %>>
        <label class="form-check-label" for="disabled">Disable account</label>
        <small class="text-muted d-block">Disabled users cannot log in.</small>
      </div>
      <div class="mb-3">
        <label class="form-label" for="contact">Contact</label>
        <input id="contact" name="contact" type="text" class="form-control" value="<%= targetUser.contact || '' %>">
      </div>
      <div class="mb-3">
        <label class="form-label" for="address">Address</label>
        <textarea id="address" name="address" class="form-control" rows="2"><%= targetUser.address || '' %></textarea>
      </div>
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Save</button>
        <a class="btn btn-secondary" href="/admin/users">Cancel</a>
      </div>
    </form>
  <% } else { %>
    <div class="alert alert-warning">User not found.</div>
    <a class="btn btn-secondary" href="/admin/users">Back</a>
  <% } %>
</div>
<%- include('partials/footer') %>
