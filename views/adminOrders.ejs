<%- include('partials/head', { pageTitle: 'Manage Orders - Supermarket App' }) %>
<%- include('partials/navbar', {
  navLinksLeft: [
    { href: '/inventory', label: 'Inventory' },
    { href: '/addProduct', label: 'Add Product' },
    { href: '/admin/orders', label: 'Orders', active: true },
    { href: '/admin/users', label: 'Users' }
  ],
  navLinksRight: [
    { href: '/logout', label: 'Logout' }
  ]
}) %>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <p class="text-uppercase text-muted small mb-1">Admin</p>
      <h3 class="mb-0">Delivery Orders</h3>
      <small class="text-muted">Review and update status</small>
    </div>
  </div>

  <% if (success && success.length) { %>
    <div class="alert alert-success"><%= success[0] %></div>
  <% } %>
  <% if (error && error.length) { %>
    <div class="alert alert-danger"><%= error[0] %></div>
  <% } %>

  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>User ID</th>
          <th>Total</th>
          <th>Savings</th>
          <th>Status</th>
          <th>Created</th>
          <th class="text-center">Update</th>
          <th class="text-center">Delete</th>
        </tr>
      </thead>
      <tbody>
        <% if (orders && orders.length) { %>
          <% orders.forEach(o => { %>
            <tr>
              <td>#<%= o.id %></td>
              <td><%= o.userId || o.user_id || 'â€”' %></td>
              <td>$<%= Number(o.total || 0).toFixed(2) %></td>
              <td>$<%= Number(o.savings || 0).toFixed(2) %></td>
              <td><span class="badge bg-secondary text-uppercase"><%= o.status %></span></td>
              <td><%= o.createdAt ? new Date(o.createdAt).toLocaleString() : '' %></td>
              <td class="text-center">
                <form action="/admin/orders/<%= o.id %>/status" method="POST" class="d-flex gap-2 justify-content-center">
                  <select name="status" class="form-select form-select-sm" style="max-width: 150px;">
                    <option value="pending" <%= o.status === 'pending' ? 'selected' : '' %>>Pending</option>
                    <option value="processing" <%= o.status === 'processing' ? 'selected' : '' %>>Processing</option>
                    <option value="completed" <%= o.status === 'completed' ? 'selected' : '' %>>Completed</option>
                  </select>
                  <button type="submit" class="btn btn-sm btn-outline-primary">Save</button>
                </form>
              </td>
              <td class="text-center">
                <form action="/admin/orders/<%= o.id %>/delete" method="POST" onsubmit="return confirm('Delete order #<%= o.id %>?');">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="8" class="text-center text-muted">No orders found.</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
<%- include('partials/footer') %>
