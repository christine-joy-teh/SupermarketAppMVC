<%
  const productNavLeft = [];
  if (user && user.role === 'admin') {
    productNavLeft.push({ href: '/inventory', label: 'Inventory' });
    productNavLeft.push({ href: '/addProduct', label: 'Add new product' });
  }
%>
<%- include('partials/head', { pageTitle: 'Product Details - Supermarket App' }) %>
<%- include('partials/navbar', {
  navLinksLeft: productNavLeft,
  navLinksRight: [
    { href: '/logout', label: 'Logout' }
  ]
}) %>

<div class="container py-4">
  <% if (product) { %>
    <div class="row g-4 align-items-center">
      <div class="col-md-5 text-center">
        <% if (product.image) { %>
          <img src="/images/<%= product.image %>" alt="<%= product.productName %>" class="img-fluid rounded shadow-sm" style="max-height:320px; object-fit:contain;">
        <% } else { %>
          <div class="border rounded p-4 text-muted">No image available</div>
        <% } %>
      </div>
      <div class="col-md-7">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h3 class="card-title mb-0"><%= product.productName %></h3>
              <% if (user && user.role === 'admin') { %>
                <span class="badge bg-secondary text-uppercase">Admin</span>
              <% } %>
            </div>
            <p class="text-muted mb-3">SKU #<%= product.id %></p>

            <% const discount = Number(product.discountPercent) || 0; const salePrice = discount > 0 ? (product.price * (1 - discount/100)) : product.price; %>
            <div class="mb-2">
              <span class="fw-semibold">Price:</span>
              <% if (discount > 0) { %>
                <span class="fs-5 text-muted text-decoration-line-through">$<%= product.price.toFixed(2) %></span>
                <span class="fs-4 ms-1 text-success">$<%= salePrice.toFixed(2) %></span>
                <span class="badge bg-danger ms-2">-<%= discount %>%</span>
              <% } else { %>
                <span class="fs-4 text-success">$<%= product.price.toFixed(2) %></span>
              <% } %>
            </div>

            <div class="mb-2">
              <span class="fw-semibold">Available stock:</span>
              <span class="<%= product.quantity > 5 ? 'text-success' : 'text-warning' %> fw-bold"><%= product.quantity %></span>
            </div>

            <div class="d-flex gap-2 mt-3">
              <% if (user && user.role === 'admin') { %>
                <a href="/updateProduct/<%= product.id %>" class="btn btn-outline-primary">Edit</a>
                <a href="/inventory" class="btn btn-secondary">Back to Inventory</a>
              <% } else { %>
                <a href="/shopping" class="btn btn-secondary">Back to Shopping</a>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% } else { %>
    <div class="alert alert-warning">No product found.</div>
  <% } %>
</div>

<%- include('partials/footer') %>
